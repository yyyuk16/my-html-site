<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="settings">è¨­å®š</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="maintab.css">
    <link rel="stylesheet" href="footer.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- å¤šè¨€èªå¯¾å¿œ -->
    <script src="multilang.js"></script>
</head>
<body>
    <!-- ğŸ’š ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="top-bar">
      <div class="header-inner">
        <div class="logo">
          <div class="logo-icon"></div>
          <span data-translate="site_title">çµæ ¸å¯¾ç­–ã‚¢ãƒ—ãƒª</span>
        </div>
        <button class="user-name-btn" id="userNameBtn">
          <span id="userNameDisplay">ã‚²ã‚¹ãƒˆ ã•ã‚“</span>
        </button>
        <div class="header-right">
          <nav>
            <ul class="tab-menu">
              <li><a href="ai.html"><span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span></a></li>
              <li><a href="score.html"><span data-translate="quiz">Q&A</span></a></li>
              <li><a href="movie.html"><span data-translate="video_watching">å‹•ç”»</span></a></li>
              <li><a href="setting.html" class="active"><span data-translate="settings">è¨­å®š</span></a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <main class="container" style="max-width: 700px; margin: 0 auto; padding-top: 3rem; padding-bottom: 3rem;">
      <div class="setting-header" style="margin-bottom: 2.5rem; text-align:center;">
        <h1 style="font-size:2.2rem; color:#2E7D32; font-weight:700; margin-bottom:0.5rem;" data-translate="settings">è¨­å®š</h1>
      </div>
      <div class="setting-sections">

        <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ -->
        <section class="setting-card">
          <button class="setting-btn" style="width: 100%; padding: 1.2rem 0; font-size: 1.1rem; font-weight: 600;" onclick="window.location.href='profile.html'" data-translate="account_info">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</button>
        </section>

        <!-- ä½¿ã„æ–¹ -->
        <section class="setting-card">
          <h2 class="setting-title" data-translate="how_to_use">ä½¿ã„æ–¹</h2>
          <ul class="setting-list">
            <li data-translate="ai_teacher_24h">ãƒ»ã€ŒAIå…ˆç”Ÿã€ã§ã¯24æ™‚é–“ã„ã¤ã§ã‚‚å¥åº·ç›¸è«‡ãŒã§ãã¾ã™ã€‚</li>
            <li data-translate="realtime_chat_desc">ãƒ»ã€Œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã€ã§ã¯åŒ»ç™‚ã‚¹ã‚¿ãƒƒãƒ•ã¨ç›´æ¥ãƒãƒ£ãƒƒãƒˆãŒå¯èƒ½ã§ã™ã€‚</li>
            <li data-translate="use_qa_video">ãƒ»Q&Aã‚„å‹•ç”»è¦–è´ã‚‚ã”æ´»ç”¨ãã ã•ã„ã€‚</li>
          </ul>
        </section>

        <!-- ãŠå•ã„åˆã‚ã› -->
        <section class="setting-card">
          <h2 class="setting-title" data-translate="contact">ãŠå•ã„åˆã‚ã›</h2>
          <ul class="setting-list">
            <li data-translate="contact_desc">ã”è³ªå•ã‚„ã”è¦æœ›ãŒã‚ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚</li>
            <li><a href="mailto:info@tb-support.jp" style="color:#2E7D32;">info@tb-support.jp</a></li>
          </ul>
        </section>

      </div>
    </main>

    <style>
      body {
        background: #fff;
        min-height: 100vh;
      }
      .setting-header {
        text-align: center;
        margin-bottom: 40px;
      }
      .setting-sections {
        display: flex;
        flex-direction: column;
        gap: 2.2rem;
      }
      .setting-card {
        background: #fff;
        border-radius: 1.2rem;
        box-shadow: 0 4px 18px 0 rgba(46,125,50,0.10);
        padding: 2rem 1.5rem;
      }
      .setting-title {
        font-size: 1.3rem;
        color: #2E7D32;
        font-weight: 600;
        margin-bottom: 1rem;
        letter-spacing: 0.02em;
      }
      .setting-list {
        list-style: none;
        padding: 0;
        margin: 0;
        color: #444;
        font-size: 1.05rem;
      }
      .setting-list li {
        margin-bottom: 0.8rem;
      }
      .setting-btn {
        background: linear-gradient(90deg, #A5D6B5 0%, #2E7D32 100%);
        color: #fff;
        border: none;
        padding: 0.6rem 1.6rem;
        border-radius: 2rem;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 2px 12px 0 rgba(46,125,50,0.10);
        transition: background 0.2s, box-shadow 0.2s;
        letter-spacing: 0.01em;
      }
      .setting-btn[disabled] {
        opacity: 0.7;
        cursor: default;
      }
      .setting-btn:hover:not([disabled]) {
        background: linear-gradient(90deg, #2E7D32 0%, #A5D6B5 100%);
        box-shadow: 0 4px 18px 0 rgba(46,125,50,0.18);
      }
      @media (max-width: 700px) {
        .setting-sections {
          gap: 1.2rem;
        }
        .setting-card {
          padding: 1.2rem 0.7rem;
        }
      }
      /* ãƒ•ãƒƒã‚¿ãƒ¼ã®è‰²ã‚’ai.htmlã¨çµ±ä¸€ */
      .footer {
        background: #2E7D32;
        color: #fff;
      }
      .footer small a {
        color: #fff;
      }

      /* --- ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ã®èª¿æ•´ --- */

      /* 1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆPCï¼‰ã§ã¯ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒŠãƒ“ã‚’éš ã™ */
      .mobile-nav {
        display: none;
      }

      /* 2. PCç‰ˆãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®ã€Œã‚²ã‚¹ãƒˆã•ã‚“ã€ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³èª¿æ•´ */
      .user-name-btn {
        background: #474646;
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
      }

      /* 3. ãƒ¢ãƒã‚¤ãƒ«ç”»é¢ï¼ˆ768pxä»¥ä¸‹ï¼‰ã®è¨­å®š */
      @media (max-width: 768px) {
        /* PCç”¨ãƒŠãƒ“ã‚’éš ã™ */
        .header-right {
          display: none;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”»åƒã®ã‚ˆã†ãªã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆã« */
        .top-bar {
          padding: 10px 15px;
          border-bottom: 1px solid #eee;
        }
        
        .header-inner {
          justify-content: space-between;
        }

        .logo span {
          font-size: 1.1rem;
          color: #66bb6a; /* ç”»åƒã®ã‚ˆã†ãªç·‘è‰²ã« */
        }

        /* ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º */
        .mobile-nav {
          display: flex;
          position: fixed;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 70px;
          background: #f8f9fa;
          border-top: 1px solid #eee;
          justify-content: space-around;
          align-items: center;
          z-index: 1000;
          padding-bottom: env(safe-area-inset-bottom); /* iPhoneã®ãƒãƒ¼å¯¾ç­– */
        }

        .nav-item {
          text-decoration: none;
          color: #888;
          display: flex;
          flex-direction: column;
          align-items: center;
          font-size: 0.7rem;
          gap: 4px;
        }

        .nav-item i {
          font-size: 1.4rem;
        }

        .nav-item.active {
          color: #333; /* é¸æŠä¸­ã®è‰² */
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸‹éƒ¨ã«ä½™ç™½ã‚’è¿½åŠ ï¼ˆãƒŠãƒ“ã«è¢«ã‚‰ãªã„ã‚ˆã†ã«ï¼‰ */
        body {
          padding-bottom: 80px;
        }
        
        .container {
          padding-top: 1rem !important; /* ã‚¹ãƒãƒ›ã§ã¯ä½™ç™½ã‚’è©°ã‚ã‚‹ */
          padding-bottom: 2rem !important;
        }

        /* PCç‰ˆã®ãƒ•ãƒƒã‚¿ãƒ¼ã‚’ã‚¹ãƒãƒ›ã§ã¯éš ã™ï¼ˆãƒŠãƒ“ãŒã‚ã‚‹ãŸã‚ï¼‰ */
        .footer {
          display: none;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«ç‰ˆã®æ–‡å­—ã‚µã‚¤ã‚ºã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
        .setting-header {
          margin-bottom: 1.5rem !important;
        }
        .setting-header h1 {
          font-size: 1.4rem !important;
          margin-bottom: 0.3rem !important;
        }
        .setting-title {
          font-size: 1rem !important;
          margin-bottom: 0.7rem !important;
        }
        .setting-list {
          font-size: 0.85rem !important;
        }
        .setting-list li {
          margin-bottom: 0.5rem !important;
          line-height: 1.5;
        }
        .setting-btn {
          font-size: 0.9rem !important;
          padding: 0.5rem 1rem !important;
        }
        .setting-card {
          padding: 0.9rem 0.7rem !important;
          border-radius: 0.9rem !important;
        }
        .setting-sections {
          gap: 0.9rem !important;
        }
      }
    </style>

    <script>
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦è¡¨ç¤ºï¼ˆFirestoreã‹ã‚‰å–å¾—ï¼‰
      async function updateUserName() {
        const userNameDisplay = document.getElementById('userNameDisplay');
        if (!userNameDisplay) return;
        
        let auth = null;
        if (window.multiLang && window.multiLang.auth) {
          auth = window.multiLang.auth;
        } else if (typeof firebase !== 'undefined' && firebase.auth) {
          auth = firebase.auth();
        }
        
        if (!auth) {
          userNameDisplay.textContent = 'ã‚²ã‚¹ãƒˆ ã•ã‚“';
          return;
        }
        
        auth.onAuthStateChanged(async (user) => {
          if (!user) {
            userNameDisplay.textContent = 'ã‚²ã‚¹ãƒˆ ã•ã‚“';
            return;
          }
          
          try {
            // Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
            const db = firebase.firestore();
            const userDoc = await db.collection('users').doc(user.uid).get();
            
            if (userDoc.exists) {
              const userData = userDoc.data();
              // nameã®ã¿ã‚’ä½¿ç”¨
              const displayName = userData.name || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
              userNameDisplay.textContent = displayName + ' ã•ã‚“';
            } else {
              // Firestoreã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
              userNameDisplay.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã•ã‚“';
            }
          } catch (error) {
            console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
            userNameDisplay.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã•ã‚“';
          }
        });
      }

      // åˆæœŸãƒ¬ãƒ³ãƒ€å¾Œã«ç¿»è¨³ã‚’é©ç”¨
      document.addEventListener('DOMContentLoaded', function(){
        updateUserName();
        if (window.multiLang && typeof window.multiLang.updateUI === 'function') {
          try { window.multiLang.updateUI(); } catch (_) {}
        }
      });
    </script>

    <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="mobile-nav">
      <a href="ai.html" class="nav-item">
        <i class="fa-solid fa-house"></i>
        <span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span>
      </a>
      <a href="score.html" class="nav-item">
        <i class="fa-solid fa-magnifying-glass"></i>
        <span data-translate="quiz">Q&A</span>
      </a>
      <a href="movie.html" class="nav-item">
        <i class="fa-regular fa-clock"></i>
        <span data-translate="video_watching">å‹•ç”»</span>
      </a>
      <a href="setting.html" class="nav-item active">
        <i class="fa-regular fa-user"></i>
        <span data-translate="settings">è¨­å®š</span>
      </a>
    </nav>

    <!-- âœ… ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆfooter.css ã®è¨­è¨ˆé€šã‚Šï¼šfooterã®ä¸­ã« .container ã‚’å…¥ã‚Œã‚‹ï¼‰ -->
    <footer class="footer">
      <div class="container">
        <small>
          <a href="#" data-translate="terms">åˆ©ç”¨è¦ç´„</a>
          <a href="#" data-translate="privacy">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a><br>
          &copy; <span data-translate="copyright_name">ã‚¹ãƒãƒ¼ãƒˆåŒ»ç™‚ãƒãƒ¼ã‚¿ãƒ«</span>
        </small>
      </div>
    </footer>
</body>
</html>