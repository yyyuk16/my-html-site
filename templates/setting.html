<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="settings">è¨­å®š</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="maintab.css">
    <link rel="stylesheet" href="footer.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- å¤šè¨€èªå¯¾å¿œ -->
    <script src="multilang.js"></script>
</head>
<body>
    <!-- ğŸ’š ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="top-bar">
      <div class="header-inner">
        <div class="logo">
          <div class="logo-icon"></div>
          <span data-translate="site_title">çµæ ¸å¯¾ç­–ã‚¢ãƒ—ãƒª</span>
        </div>
        <button class="user-name-btn" id="userNameBtn">
          <span id="userNameDisplay">ã‚²ã‚¹ãƒˆ ã•ã‚“</span>
        </button>
        <div class="header-right">
          <nav>
            <ul class="tab-menu">
              <li><a href="ai.html"><span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span></a></li>
              <li><a href="score.html"><span data-translate="quiz">Q&A</span></a></li>
              <li><a href="movie.html"><span data-translate="video_watching">å‹•ç”»</span></a></li>
              <li><a href="setting.html" class="active"><span data-translate="settings">è¨­å®š</span></a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <main class="container" style="max-width: 700px; margin: 0 auto; padding-top: 3rem; padding-bottom: 3rem;">
      <div class="setting-header" style="margin-bottom: 2.5rem; text-align:center;">
        <h1 style="font-size:2.2rem; color:#2E7D32; font-weight:700; margin-bottom:0.5rem;" data-translate="settings">è¨­å®š</h1>
      </div>
      <div class="setting-sections">

        <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ -->
        <section class="setting-card">
          <button class="setting-btn" style="width: 100%; padding: 1.2rem 0; font-size: 1.1rem; font-weight: 600;" onclick="window.location.href='profile.html'" data-translate="account_info">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</button>
        </section>

        <!-- ä½¿ã„æ–¹ -->
        <section class="setting-card">
          <h2 class="setting-title" data-translate="how_to_use">ä½¿ã„æ–¹</h2>
          <ul class="setting-list">
            <li data-translate="ai_teacher_24h">ãƒ»ã€ŒAIå…ˆç”Ÿã€ã§ã¯24æ™‚é–“ã„ã¤ã§ã‚‚å¥åº·ç›¸è«‡ãŒã§ãã¾ã™ã€‚</li>
            <li data-translate="realtime_chat_desc">ãƒ»ã€Œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã€ã§ã¯åŒ»ç™‚ã‚¹ã‚¿ãƒƒãƒ•ã¨ç›´æ¥ãƒãƒ£ãƒƒãƒˆãŒå¯èƒ½ã§ã™ã€‚</li>
            <li data-translate="use_qa_video">ãƒ»Q&Aã‚„å‹•ç”»è¦–è´ã‚‚ã”æ´»ç”¨ãã ã•ã„ã€‚</li>
          </ul>
        </section>

        <!-- ãŠå•ã„åˆã‚ã› -->
        <section class="setting-card">
          <h2 class="setting-title" data-translate="contact">ãŠå•ã„åˆã‚ã›</h2>
          <ul class="setting-list">
            <li data-translate="contact_desc">ã”è³ªå•ã‚„ã”è¦æœ›ãŒã‚ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚</li>
            <li><a href="mailto:info@tb-support.jp" style="color:#2E7D32;">info@tb-support.jp</a></li>
          </ul>
        </section>

      </div>
    </main>

    <style>
      body {
        background: #fff;
        min-height: 100vh;
      }
      .setting-header {
        text-align: center;
        margin-bottom: 40px;
      }
      .setting-sections {
        display: flex;
        flex-direction: column;
        gap: 2.2rem;
      }
      .setting-card {
        background: #fff;
        border-radius: 1.2rem;
        box-shadow: 0 4px 18px 0 rgba(46,125,50,0.10);
        padding: 2rem 1.5rem;
      }
      .setting-title {
        font-size: 1.3rem;
        color: #2E7D32;
        font-weight: 600;
        margin-bottom: 1rem;
        letter-spacing: 0.02em;
      }
      .setting-list {
        list-style: none;
        padding: 0;
        margin: 0;
        color: #444;
        font-size: 1.05rem;
      }
      .setting-list li {
        margin-bottom: 0.8rem;
      }
      .setting-btn {
        background: linear-gradient(90deg, #A5D6B5 0%, #2E7D32 100%);
        color: #fff;
        border: none;
        padding: 0.6rem 1.6rem;
        border-radius: 2rem;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 2px 12px 0 rgba(46,125,50,0.10);
        transition: background 0.2s, box-shadow 0.2s;
        letter-spacing: 0.01em;
      }
      .setting-btn[disabled] {
        opacity: 0.7;
        cursor: default;
      }
      .setting-btn:hover:not([disabled]) {
        background: linear-gradient(90deg, #2E7D32 0%, #A5D6B5 100%);
        box-shadow: 0 4px 18px 0 rgba(46,125,50,0.18);
      }
      @media (max-width: 700px) {
        .setting-sections {
          gap: 1.2rem;
        }
        .setting-card {
          padding: 1.2rem 0.7rem;
        }
      }
      /* ãƒ•ãƒƒã‚¿ãƒ¼ã®è‰²ã‚’ai.htmlã¨çµ±ä¸€ */
      .footer {
        background: #2E7D32;
        color: #fff;
      }
      .footer small a {
        color: #fff;
      }
    </style>

    <script>
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦è¡¨ç¤ºï¼ˆFirestoreã‹ã‚‰å–å¾—ï¼‰
      async function updateUserName() {
        const userNameDisplay = document.getElementById('userNameDisplay');
        if (!userNameDisplay) return;
        
        let auth = null;
        if (window.multiLang && window.multiLang.auth) {
          auth = window.multiLang.auth;
        } else if (typeof firebase !== 'undefined' && firebase.auth) {
          auth = firebase.auth();
        }
        
        if (!auth) {
          userNameDisplay.textContent = 'ã‚²ã‚¹ãƒˆ ã•ã‚“';
          return;
        }
        
        auth.onAuthStateChanged(async (user) => {
          if (!user) {
            userNameDisplay.textContent = 'ã‚²ã‚¹ãƒˆ ã•ã‚“';
            return;
          }
          
          try {
            // Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
            const db = firebase.firestore();
            const userDoc = await db.collection('users').doc(user.uid).get();
            
            if (userDoc.exists) {
              const userData = userDoc.data();
              // nameã®ã¿ã‚’ä½¿ç”¨
              const displayName = userData.name || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
              userNameDisplay.textContent = displayName + ' ã•ã‚“';
            } else {
              // Firestoreã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
              userNameDisplay.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã•ã‚“';
            }
          } catch (error) {
            console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
            userNameDisplay.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã•ã‚“';
          }
        });
      }

      // Firebaseèªè¨¼ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ï¼ˆãƒ€ãƒŸãƒ¼è¡¨ç¤ºï¼‰
      document.addEventListener('DOMContentLoaded', function() {
        updateUserName();
        // å®Ÿéš›ã¯firebase.auth().onAuthStateChangedãªã©ã§å–å¾—
        // ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ãƒ€ãƒŸãƒ¼å€¤
        const userNameEl = document.getElementById('userName');
        const userEmailEl = document.getElementById('userEmail');
        if (userNameEl) userNameEl.textContent = "ã‚²ã‚¹ãƒˆ";
        if (userEmailEl) userEmailEl.textContent = "æœªç™»éŒ²";
        // è¨€èªã«åŸºã¥ãç¿»è¨³ã‚’é©ç”¨
        if (window.multiLang && typeof window.multiLang.updateUI === 'function') {
          try { window.multiLang.updateUI(); } catch (_) {}
        }
        // å¿µã®ãŸã‚ãƒ˜ãƒƒãƒ€ãƒ¼/ãƒ•ãƒƒã‚¿ãƒ¼ã®æ–‡å­—ã‚‚æ˜ç¤ºçš„ã«æ›´æ–°
        try {
          const lang = (window.multiLang && window.multiLang.currentLanguage) || 'ja';
          const dict = (window.multiLang && window.multiLang.translations && window.multiLang.translations[lang]) || {};
          const titleEl = document.querySelector('.site-title[data-translate]');
          if (titleEl && dict[titleEl.getAttribute('data-translate')]) {
            titleEl.textContent = dict[titleEl.getAttribute('data-translate')];
          }
          const termsEl = document.querySelector('footer [data-translate="terms"]');
          if (termsEl && dict.terms) termsEl.textContent = dict.terms;
          const privacyEl = document.querySelector('footer [data-translate="privacy"]');
          if (privacyEl && dict.privacy) privacyEl.textContent = dict.privacy;
          const copyEl = document.querySelector('footer [data-translate="copyright_name"]');
          if (copyEl && dict['copyright_name']) copyEl.textContent = dict['copyright_name'];
        } catch(_) {}
      });

      function logout() {
        // å®Ÿéš›ã¯firebase.auth().signOut()ãªã©
        alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰');
        // location.reload();
      }
    </script>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer container">
      <small>
        <a href="#" data-translate="terms">åˆ©ç”¨è¦ç´„</a>
        <a href="#" data-translate="privacy">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a><br>
        &copy; <span data-translate="copyright_name">ã‚¹ãƒãƒ¼ãƒˆåŒ»ç™‚ãƒãƒ¼ã‚¿ãƒ«</span>
      </small>
    </footer>
</body>
</html>