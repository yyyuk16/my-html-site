<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>AIã‚¯ã‚¤ã‚ºï¼ˆ10å•å›ºå®šï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: "Noto Sans JP", sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    .quiz-container { max-width: 600px; margin: 20px auto; padding: 20px; background: #fff;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h1 { color: #1976d2; font-size: 1.5rem; text-align: center; }
    button { padding: 10px 16px; border: none; border-radius: 8px; background: #1976d2; color: #fff;
      cursor: pointer; margin-top: 10px; }
    .choices button { display: block; width: 100%; margin: 6px 0; background: #eee; color: #333; }
    .choices button.correct { background: #c8f7c5; border: 1px solid #4caf50; }
    .choices button.wrong { background: #f7c5c5; border: 1px solid #e53935; }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1>çµæ ¸ã‚¯ã‚¤ã‚ºï¼ˆ10å•ï¼‰</h1>
    
    <!-- ãƒ­ã‚°ã‚¤ãƒ³/ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º -->
    <div id="authSection" style="margin-bottom: 20px;">
      <div id="loginForm" style="display: none;">
        <h3>ãƒ­ã‚°ã‚¤ãƒ³</h3>
        <div style="margin-bottom: 10px;">
          <input type="email" id="loginEmail" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div style="margin-bottom: 10px;">
          <input type="password" id="loginPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" style="width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <button id="loginBtn" style="margin-right: 10px;">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <button id="signupBtn">æ–°è¦ç™»éŒ²</button>
      </div>
      
      <div id="userInfo" style="display: none;">
        <h3>ãƒ­ã‚°ã‚¤ãƒ³ä¸­</h3>
        <p id="userDisplayName"></p>
        <p id="userEmail"></p>
        <button id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>
    
    <button id="startBtn">ã‚¯ã‚¤ã‚ºé–‹å§‹</button>
    <div id="quiz"></div>
  </div>

  <!-- âœ… Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script>
    // ğŸ”‘ Firebase è¨­å®šï¼ˆè‡ªåˆ†ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
    const firebaseConfig = {
  apiKey: "AIzaSyB7TuGhOKbB4w7DDYt7KTejy-TrcxVZmpU",
  authDomain: "web01-2484d.firebaseapp.com",
  databaseURL: "https://web01-2484d-default-rtdb.firebaseio.com",
  projectId: "web01-2484d",
  storageBucket: "web01-2484d.firebasestorage.app",
  messagingSenderId: "90159472898",
  appId: "1:90159472898:web:261ec71f9919611011e21b",
  measurementId: "G-9TGR07ZSY9"
};

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // âœ… é™çš„ãªã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ï¼ˆ10å•ï¼‰
    const allQuestions = [
      {
        question: "çµæ ¸ã¯ä¸»ã«ã©ã®è‡“å™¨ã«æ„ŸæŸ“ã—ã¾ã™ã‹ï¼Ÿ",
        choices: ["å¿ƒè‡“", "è‚º", "è‚è‡“", "è…è‡“"],
        answer: "è‚º",
        explanation: "çµæ ¸èŒã¯ä¸»ã«è‚ºã«æ„ŸæŸ“ã—ã¾ã™ãŒã€å…¨èº«ã«ã‚‚åºƒãŒã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚"
      },
      {
        question: "çµæ ¸ã®åŸå› èŒã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
        choices: ["ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ã‚¦ã‚¤ãƒ«ã‚¹", "ãƒã‚¤ã‚³ãƒã‚¯ãƒ†ãƒªã‚¦ãƒ ãƒ»ãƒãƒ¥ãƒ™ãƒ«ã‚¯ãƒ­ãƒ¼ã‚·ã‚¹", "å¤§è…¸èŒ", "é»„è‰²ãƒ–ãƒ‰ã‚¦çƒèŒ"],
        answer: "ãƒã‚¤ã‚³ãƒã‚¯ãƒ†ãƒªã‚¦ãƒ ãƒ»ãƒãƒ¥ãƒ™ãƒ«ã‚¯ãƒ­ãƒ¼ã‚·ã‚¹",
        explanation: "çµæ ¸ã¯çµæ ¸èŒï¼ˆMycobacterium tuberculosisï¼‰ãŒåŸå› ã§ã™ã€‚"
      },
      {
        question: "çµæ ¸ã®ä¸»ãªæ„ŸæŸ“çµŒè·¯ã¯ï¼Ÿ",
        choices: ["é£Ÿã¹ç‰©", "é£›æ²«æ„ŸæŸ“", "æ¥è§¦æ„ŸæŸ“", "è¡€æ¶²æ„ŸæŸ“"],
        answer: "é£›æ²«æ„ŸæŸ“",
        explanation: "å’³ã‚„ãã—ã‚ƒã¿ã«ã‚ˆã‚‹é£›æ²«ã‚’å¸ã„è¾¼ã‚€ã“ã¨ã§æ„ŸæŸ“ã—ã¾ã™ã€‚"
      },
      {
        question: "çµæ ¸ã®è¨ºæ–­ã«ä½¿ã‚ã‚Œã‚‹æ¤œæŸ»ã¯ï¼Ÿ",
        choices: ["èƒ¸éƒ¨Xç·šæ¤œæŸ»", "å¿ƒé›»å›³", "è…¹éƒ¨ã‚¨ã‚³ãƒ¼", "å°¿æ¤œæŸ»"],
        answer: "èƒ¸éƒ¨Xç·šæ¤œæŸ»",
        explanation: "çµæ ¸ã®ç–‘ã„ãŒã‚ã‚‹å ´åˆã¯ã¾ãšèƒ¸éƒ¨Xç·šã§è‚ºã®å½±ã‚’ç¢ºèªã—ã¾ã™ã€‚"
      },
      {
        question: "çµæ ¸ã®æ²»ç™‚ã§é‡è¦ãªã®ã¯ï¼Ÿ",
        choices: ["æŠ—ç”Ÿç‰©è³ªã‚’1é€±é–“ã ã‘é£²ã‚€", "é•·æœŸé–“ã®æŠ—çµæ ¸è–¬æœç”¨", "ãƒ“ã‚¿ãƒŸãƒ³Cæ‘‚å–", "å®‰é™ã®ã¿"],
        answer: "é•·æœŸé–“ã®æŠ—çµæ ¸è–¬æœç”¨",
        explanation: "6ã‹æœˆä»¥ä¸Šã®æœè–¬ç¶™ç¶šãŒå¿…è¦ã§ã™ã€‚"
      },
      {
        question: "çµæ ¸æ²»ç™‚ã‚’ä¸­æ–­ã™ã‚‹ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ",
        choices: ["ã™ãæ²»ã‚‹", "è–¬å‰¤è€æ€§çµæ ¸ãŒç”Ÿã˜ã‚‹", "å‰¯ä½œç”¨ãŒæ¸›ã‚‹", "ç‰¹ã«å¤‰åŒ–ã¯ãªã„"],
        answer: "è–¬å‰¤è€æ€§çµæ ¸ãŒç”Ÿã˜ã‚‹",
        explanation: "æ²»ç™‚ä¸­æ–­ã¯è€æ€§èŒã‚’ç”Ÿã¿ã€é›£æ²»æ€§ã«ã¤ãªãŒã‚Šã¾ã™ã€‚"
      },
      {
        question: "æ—¥æœ¬ã§çµæ ¸ã®æ‚£è€…æ•°ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ",
        choices: ["å¹´é–“ ç´„1ä¸‡äºº", "å¹´é–“ ç´„100äºº", "å¹´é–“ ç´„50ä¸‡äºº", "å¹´é–“ ç´„1äºº"],
        answer: "å¹´é–“ ç´„1ä¸‡äºº",
        explanation: "æ—¥æœ¬ã§ã¯å¹´é–“1ä¸‡äººå‰å¾Œã®æ–°è¦æ‚£è€…ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚"
      },
      {
        question: "çµæ ¸ã®åˆæœŸç—‡çŠ¶ã«å½“ã¦ã¯ã¾ã‚‰ãªã„ã‚‚ã®ã¯ï¼Ÿ",
        choices: ["å’³", "ç™ºç†±", "ä½“é‡æ¸›å°‘", "ç›®ã®ã‹ã‚†ã¿"],
        answer: "ç›®ã®ã‹ã‚†ã¿",
        explanation: "å’³ãƒ»ç™ºç†±ãƒ»ä½“é‡æ¸›å°‘ã¯å…¸å‹çš„ãªç—‡çŠ¶ã§ã™ãŒç›®ã®ã‹ã‚†ã¿ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚"
      },
      {
        question: "çµæ ¸ã®æ„ŸæŸ“äºˆé˜²ã«æœ‰åŠ¹ãªãƒ¯ã‚¯ãƒãƒ³ã¯ï¼Ÿ",
        choices: ["ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ãƒ¯ã‚¯ãƒãƒ³", "BCGãƒ¯ã‚¯ãƒãƒ³", "MMRãƒ¯ã‚¯ãƒãƒ³", "æ°´ç—˜ãƒ¯ã‚¯ãƒãƒ³"],
        answer: "BCGãƒ¯ã‚¯ãƒãƒ³",
        explanation: "ä¹³å…ã«æ¥ç¨®ã•ã‚Œã‚‹BCGãƒ¯ã‚¯ãƒãƒ³ã¯é‡ç—‡çµæ ¸äºˆé˜²ã«æœ‰åŠ¹ã§ã™ã€‚"
      },
      {
        question: "çµæ ¸ã®æ²»ç™‚ã§æœ€ã‚‚é‡è¦ãªã“ã¨ã¯ï¼Ÿ",
        choices: ["é‹å‹•åˆ¶é™", "ååˆ†ãªæ°´åˆ†æ‘‚å–", "æœè–¬ã®ç¶™ç¶š", "æ „é¤Šè£œåŠ©é£Ÿå“ã®æ‘‚å–"],
        answer: "æœè–¬ã®ç¶™ç¶š",
        explanation: "é€”ä¸­ã§ã‚„ã‚ãšã«ã—ã£ã‹ã‚Šé£²ã¿ç¶šã‘ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚"
      }
    ];

    let currentIndex = 0;
    let score = 0;
    let currentUser = null;

    // âœ… èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
    auth.onAuthStateChanged((user) => {
      currentUser = user;
      if (user) {
        // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("userInfo").style.display = "block";
        document.getElementById("userDisplayName").textContent = `ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ${user.displayName || user.email}`;
        document.getElementById("userEmail").textContent = `ãƒ¡ãƒ¼ãƒ«: ${user.email}`;
        document.getElementById("startBtn").disabled = false;
      } else {
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆçŠ¶æ…‹
        document.getElementById("loginForm").style.display = "block";
        document.getElementById("userInfo").style.display = "none";
        document.getElementById("startBtn").disabled = true;
      }
    });

    // âœ… ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
    document.getElementById("loginBtn").addEventListener("click", () => {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      
      if (!email || !password) {
        alert("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      
      auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
        .then(() => {
          return auth.signInWithEmailAndPassword(email, password);
        })
        .then(() => {
          console.log("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ");
        })
        .catch((error) => {
          console.error("ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:", error);
          alert("ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
        });
    });

    // âœ… æ–°è¦ç™»éŒ²æ©Ÿèƒ½
    document.getElementById("signupBtn").addEventListener("click", () => {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      
      if (!email || !password) {
        alert("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      
      if (password.length < 6) {
        alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          console.log("æ–°è¦ç™»éŒ²æˆåŠŸ");
        })
        .catch((error) => {
          console.error("æ–°è¦ç™»éŒ²ã‚¨ãƒ©ãƒ¼:", error);
          alert("æ–°è¦ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
        });
    });

    // âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
    document.getElementById("logoutBtn").addEventListener("click", () => {
      auth.signOut()
        .then(() => {
          console.log("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ");
        })
        .catch((error) => {
          console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error);
        });
    });

    function renderQuestion() {
      const container = document.getElementById("quiz");
      container.innerHTML = "";

      if (currentIndex >= allQuestions.length) {
        container.innerHTML = `<h2>çµ‚äº†ï¼</h2>
          <p>ã‚¹ã‚³ã‚¢: ${score} / ${allQuestions.length}</p>`;

        // âœ… ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
        if (!currentUser) {
          alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
          return;
        }

        // âœ… Firestore ã«ã‚¹ã‚³ã‚¢ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
        db.collection("ai_quiz_scores").add({
          score: score,
          total: allQuestions.length,
          userId: currentUser.uid,
          userName: currentUser.displayName || currentUser.email,
          userEmail: currentUser.email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          console.log("ã‚¹ã‚³ã‚¢ä¿å­˜å®Œäº†");
          // ä¿å­˜æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
          const successMsg = document.createElement("p");
          successMsg.textContent = "ã‚¹ã‚³ã‚¢ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼";
          successMsg.style.color = "#4caf50";
          successMsg.style.fontWeight = "bold";
          container.appendChild(successMsg);
          
          // âœ… ã‚¯ã‚¤ã‚ºçµ‚äº†å¾Œã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
          addQuizEndButtons();
        }).catch(err => {
          console.error("ã‚¹ã‚³ã‚¢ä¿å­˜å¤±æ•—:", err);
          // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
          const errorMsg = document.createElement("p");
          errorMsg.textContent = "ã‚¹ã‚³ã‚¢ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
          errorMsg.style.color = "#e53935";
          errorMsg.style.fontWeight = "bold";
          container.appendChild(errorMsg);
          
          // âœ… ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
          addQuizEndButtons();
        });
        return;
      }

      const q = allQuestions[currentIndex];
      const div = document.createElement("div");
      div.innerHTML = `
        <p><b>Q${currentIndex + 1}: ${q.question}</b></p>
        <div class="choices">
          ${q.choices.map(c => `<button>${c}</button>`).join("")}
        </div>
        <p style="display:none;" class="exp">è§£èª¬: ${q.explanation}</p>
      `;

      div.querySelectorAll(".choices button").forEach(btn => {
        btn.addEventListener("click", () => {
          const exp = div.querySelector(".exp");
          exp.style.display = "block";
          if (btn.textContent === q.answer) {
            btn.classList.add("correct"); score++;
          } else {
            btn.classList.add("wrong");
          }
          const nextBtn = document.createElement("button");
          nextBtn.textContent = currentIndex + 1 === allQuestions.length ? "çµæœã‚’è¦‹ã‚‹" : "æ¬¡ã¸";
          nextBtn.addEventListener("click", () => { currentIndex++; renderQuestion(); });
          div.appendChild(nextBtn);
          div.querySelectorAll(".choices button").forEach(b => b.disabled = true);
        });
      });

      container.appendChild(div);
    }

    // âœ… ã‚¯ã‚¤ã‚ºçµ‚äº†å¾Œã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
    function addQuizEndButtons() {
      const container = document.getElementById("quiz");
      
      // ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
      const buttonContainer = document.createElement("div");
      buttonContainer.style.marginTop = "20px";
      buttonContainer.style.textAlign = "center";
      
      // ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ãƒœã‚¿ãƒ³
      const retryBtn = document.createElement("button");
      retryBtn.textContent = "ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦";
      retryBtn.style.marginRight = "10px";
      retryBtn.style.backgroundColor = "#4caf50";
      retryBtn.addEventListener("click", () => {
        // ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆã›ãšã«æœ€åˆã‹ã‚‰å†é–‹å§‹
        currentIndex = 0;
        renderQuestion();
      });
      
      // çµ‚äº†ãƒœã‚¿ãƒ³
      const endBtn = document.createElement("button");
      endBtn.textContent = "çµ‚äº†";
      endBtn.style.backgroundColor = "#f44336";
      endBtn.addEventListener("click", () => {
        // score.htmlã«æˆ»ã‚‹
        window.location.href = "score.html";
      });
      
      buttonContainer.appendChild(retryBtn);
      buttonContainer.appendChild(endBtn);
      container.appendChild(buttonContainer);
    }

    document.getElementById("startBtn").addEventListener("click", () => {
      // âœ… ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ãƒã‚§ãƒƒã‚¯
      if (!currentUser) {
        alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
        return;
      }
      
      // âœ… ã‚¯ã‚¤ã‚ºé–‹å§‹
      document.getElementById("authSection").style.display = "none";
      document.getElementById("startBtn").style.display = "none";
      
      score = 0; 
      currentIndex = 0;
      renderQuestion();
    });
  </script>
</body>
</html>
