<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-translate="ai_chat">AIãƒãƒ£ãƒƒãƒˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="hetter.css">
  <link rel="stylesheet" href="footer.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- å¤šè¨€èªå¯¾å¿œ -->
  <script src="multilang.js"></script>
</head>
<body>
     <!-- ğŸ’š ãƒ˜ãƒƒãƒ€ãƒ¼ -->
     <header class="top-bar">
      <div class="header-inner">
        <div class="logo">
          <div class="logo-icon"></div>
          <span data-translate="site_title">çµæ ¸å¯¾ç­–ã‚¢ãƒ—ãƒª</span>
        </div>
      <button class="user-name-btn" id="userNameBtn">
        <span id="userNameDisplay" data-translate="guest">ã‚²ã‚¹ãƒˆ</span><span id="userNameSuffix" data-translate="honorific_suffix"> ã•ã‚“</span>
      </button>
      <div class="header-right">
        <nav>
          <ul class="tab-menu">
            <li><a href="ai.html" class="active"><span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span></a></li>
            <li><a href="score.html"><span data-translate="quiz">Q&A</span></a></li>
            <li><a href="movie.html"><span data-translate="video_watching">å‹•ç”»</span></a></li>
            <li><a href="setting.html"><span data-translate="settings">è¨­å®š</span></a></li>
          </ul>
        </nav>
      </div>
      </div>
    </header>

  <!-- ãƒ¡ã‚¤ãƒ³ -->
  <main class="container" style="max-width: 1000px; margin: 0 auto; padding: 3rem 1rem;">
    <div class="section-title">
      <span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span>
    </div>
    <p class="section-subtitle" data-translate="ai_teacher_24h">åˆ†ã‹ã‚‰ãªã„ã“ã¨ã€ä¸å®‰ãªã“ã¨ã¯ç©æ¥µçš„ã«è³ªå•ã—ã¾ã—ã‚‡ã†ã€‚</p>

    <div class="cards">
      <!-- å·¦ã®ã‚«ãƒ¼ãƒ‰ -->
      <div class="card green" onclick="startChat('teacher')">
        <h3 data-translate="ai_teacher">AIå…ˆç”Ÿ</h3>
        <p data-translate="ai_teacher_24h">ã€ŒAIå…ˆç”Ÿã€ã§ã¯<br>24æ™‚é–“ã„ã¤ã§ã‚‚å¥åº·ç›¸è«‡ãŒã§ãã¾ã™ã€‚</p>
        <button class="start-chat-btn"><span data-translate="start_chat">ãƒãƒ£ãƒƒãƒˆã‚’å§‹ã‚ã‚‹</span></button>
      </div>

      <!-- å³ã®ã‚«ãƒ¼ãƒ‰ -->
      <div class="card blue" onclick="startChat('real')">
        <h3 data-translate="realtime_chat">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆï¼ˆæ‚£è€…ç”¨ï¼‰</h3>
        <p data-translate="realtime_chat_desc">ã€Œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã€ã§ã¯<br>ä¿å¥å¸«ã¨ã®ç›´æ¥ãƒãƒ£ãƒƒãƒˆãŒå¯èƒ½ã§ã™ã€‚</p>
        <button class="start-chat-btn"><span data-translate="start_chat">ãƒãƒ£ãƒƒãƒˆã‚’å§‹ã‚ã‚‹</span></button>
      </div>
    </div>
  </main>

  <!-- âœ… ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆfooter.css ã®è¨­è¨ˆé€šã‚Šï¼šfooterã®ä¸­ã« .container ã‚’å…¥ã‚Œã‚‹ï¼‰ -->
  <footer class="footer">
    <div class="container">
      <small>
        <a href="#" data-translate="terms">åˆ©ç”¨è¦ç´„</a>
        <a href="#" data-translate="privacy">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a><br>
        &copy; <span data-translate="copyright_name">ã‚¹ãƒãƒ¼ãƒˆåŒ»ç™‚ãƒãƒ¼ã‚¿ãƒ«</span>
      </small>
    </div>
  </footer>

  <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="mobile-nav">
    <a href="ai.html" class="nav-item active">
      <i class="fa-solid fa-house"></i>
      <span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span>
    </a>
    <a href="score.html" class="nav-item">
      <i class="fa-solid fa-magnifying-glass"></i>
      <span data-translate="quiz">Q&A</span>
    </a>
    <a href="movie.html" class="nav-item">
      <i class="fa-regular fa-clock"></i>
      <span data-translate="video_watching">å‹•ç”»</span>
    </a>
    <a href="setting.html" class="nav-item">
      <i class="fa-regular fa-user"></i>
      <span data-translate="settings">è¨­å®š</span>
    </a>
  </nav>

  <style>
    body {
      background: #fff;
      min-height: 100vh;
      font-family: 'Noto Sans JP', sans-serif;
      margin: 0;
    }
    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 0.3rem;
    }
    .section-subtitle {
      font-size: 1rem;
      margin-bottom: 2rem;
      color: #555;
    }
    .cards {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .card {
      flex: 1;
      min-width: 280px;
      max-width: 450px;
      border-radius: 18px;
      padding: 24px;
      color: #fff;
      cursor: pointer;
      transition: transform 0.25s, box-shadow 0.25s;
    }
    .card.green {
      background: #8bc34a;
    }
    .card.blue {
      background: #d12b02cc;
    }
    .card h3 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    .card p {
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }
    .start-chat-btn {
      display: inline-block;
      background: #fff;
      border: none;
      border-radius: 30px;
      padding: 10px 20px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      color: inherit;
      transition: background 0.2s, transform 0.2s;
    }
    .card.green .start-chat-btn { color: #388e3c; }
    .card.blue .start-chat-btn { color: #c2410c; }
    .start-chat-btn:hover {
      background: #f0f0f0;
      transform: scale(1.05);
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    @media (max-width: 768px) {
      .cards {
        flex-direction: column;
      }
    }

    /* --- ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ã®èª¿æ•´ --- */

    /* 1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆPCï¼‰ã§ã¯ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒŠãƒ“ã‚’éš ã™ */
    .mobile-nav {
      display: none;
    }

    /* 2. PCç‰ˆãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®ã€Œã‚²ã‚¹ãƒˆã•ã‚“ã€ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³èª¿æ•´ */
    .user-name-btn {
      background: #474646;
      border: none;
      border-radius: 20px;
      padding: 5px 15px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }

    /* 3. ãƒ¢ãƒã‚¤ãƒ«ç”»é¢ï¼ˆ768pxä»¥ä¸‹ï¼‰ã®è¨­å®š */
    @media (max-width: 768px) {
      /* PCç”¨ãƒŠãƒ“ã‚’éš ã™ */
      .header-right {
        display: none;
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”»åƒã®ã‚ˆã†ãªã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆã« */
      .top-bar {
        padding: 10px 15px;
        border-bottom: 1px solid #eee;
      }
      
      .header-inner {
        justify-content: space-between;
      }

      .logo span {
        font-size: 1.1rem;
        color: #66bb6a; /* ç”»åƒã®ã‚ˆã†ãªç·‘è‰²ã« */
      }

      /* ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º */
      .mobile-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 70px;
        background: #f8f9fa;
        border-top: 1px solid #eee;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
        padding-bottom: env(safe-area-inset-bottom); /* iPhoneã®ãƒãƒ¼å¯¾ç­– */
      }

      .nav-item {
        text-decoration: none;
        color: #888;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 0.7rem;
        gap: 4px;
      }

      .nav-item i {
        font-size: 1.4rem;
      }

      .nav-item.active {
        color: #333; /* é¸æŠä¸­ã®è‰² */
      }

      /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸‹éƒ¨ã«ä½™ç™½ã‚’è¿½åŠ ï¼ˆãƒŠãƒ“ã«è¢«ã‚‰ãªã„ã‚ˆã†ã«ï¼‰ */
      body {
        padding-bottom: 80px;
      }
      
      .container {
        padding-top: 1.5rem !important; /* ã‚¹ãƒãƒ›ã§ã¯ä½™ç™½ã‚’è©°ã‚ã‚‹ */
      }

      /* PCç‰ˆã®ãƒ•ãƒƒã‚¿ãƒ¼ã‚’ã‚¹ãƒãƒ›ã§ã¯éš ã™ï¼ˆãƒŠãƒ“ãŒã‚ã‚‹ãŸã‚ï¼‰ */
      .footer {
        display: none;
      }
    }
  </style>

  <script>
    function startChat(type) {
      if (type === 'teacher') {
        window.location.href = 'teacher.html';
      } else if (type === 'real') {
        window.location.href = 'real.html';
      }
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦è¡¨ç¤ºï¼ˆFirestoreã‹ã‚‰å–å¾—ï¼‰
    async function updateUserName() {
      const userNameDisplay = document.getElementById('userNameDisplay');
      if (!userNameDisplay) return;
      
      let auth = null;
      if (window.multiLang && window.multiLang.auth) {
        auth = window.multiLang.auth;
      } else if (typeof firebase !== 'undefined' && firebase.auth) {
        auth = firebase.auth();
      }
      
      if (!auth) {
        const guestText = t('guest', 'ã‚²ã‚¹ãƒˆ');
        const suffix = t('honorific_suffix', 'ã•ã‚“');
        userNameDisplay.textContent = guestText;
        const suffixEl = document.getElementById('userNameSuffix');
        if (suffixEl) suffixEl.textContent = suffix ? ' ' + suffix : '';
        return;
      }
      
      auth.onAuthStateChanged(async (user) => {
        if (!user) {
          const guestText = t('guest', 'ã‚²ã‚¹ãƒˆ');
          const suffix = t('honorific_suffix', 'ã•ã‚“');
          userNameDisplay.textContent = guestText;
          const suffixEl = document.getElementById('userNameSuffix');
          if (suffixEl) suffixEl.textContent = suffix ? ' ' + suffix : '';
          return;
        }
        
        try {
          // Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
          const db = firebase.firestore();
          const userDoc = await db.collection('users').doc(user.uid).get();
          
          if (userDoc.exists) {
            const userData = userDoc.data();
            // nameã®ã¿ã‚’ä½¿ç”¨
            const displayName = userData.name || t('user', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼');
            const suffix = t('honorific_suffix', 'ã•ã‚“');
            userNameDisplay.textContent = displayName;
            const suffixEl = document.getElementById('userNameSuffix');
            if (suffixEl) suffixEl.textContent = suffix ? ' ' + suffix : '';
          } else {
            // Firestoreã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
            const userText = t('user', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼');
            const suffix = t('honorific_suffix', 'ã•ã‚“');
            userNameDisplay.textContent = userText;
            const suffixEl = document.getElementById('userNameSuffix');
            if (suffixEl) suffixEl.textContent = suffix ? ' ' + suffix : '';
          }
        } catch (error) {
          console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
          const userText = t('user', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼');
          const suffix = t('honorific_suffix', 'ã•ã‚“');
          userNameDisplay.textContent = userText;
          const suffixEl = document.getElementById('userNameSuffix');
          if (suffixEl) suffixEl.textContent = suffix ? ' ' + suffix : '';
        }
      });
    }

    // åˆæœŸãƒ¬ãƒ³ãƒ€å¾Œã«ç¿»è¨³ã‚’é©ç”¨
    document.addEventListener('DOMContentLoaded', function(){
      updateUserName();
      if (window.multiLang && typeof window.multiLang.updateUI === 'function') {
        try { window.multiLang.updateUI(); } catch (_) {}
      }
    });
  </script>
</body>
</html>
