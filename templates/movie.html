<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="video_watching">å‹•ç”»è¦–è´</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="maintab.css">
    <link rel="stylesheet" href="footer.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- å¤šè¨€èªå¯¾å¿œ -->
    <script src="multilang.js"></script>

    <!-- YouTube IFrame APIï¼ˆè¦–è´å®Œäº†æ¤œçŸ¥ç”¨ï¼‰ -->
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <!-- ğŸ’š ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="top-bar">
      <div class="header-inner">
        <div class="logo">
          <div class="logo-icon"></div>
          <span data-translate="site_title">çµæ ¸å¯¾ç­–ã‚¢ãƒ—ãƒª</span>
        </div>
        <button class="user-name-btn" id="userNameBtn">
          <span id="userNameDisplay">ã‚²ã‚¹ãƒˆ ã•ã‚“</span>
        </button>
        <div class="header-right">
          <nav>
            <ul class="tab-menu">
              <li><a href="ai.html"><span data-translate="chat">ãƒãƒ£ãƒƒãƒˆ</span></a></li>
              <li><a href="score.html"><span data-translate="quiz">Q&A</span></a></li>
              <li><a href="movie.html" class="active"><span data-translate="video_watching">å‹•ç”»</span></a></li>
              <li><a href="setting.html"><span data-translate="settings">è¨­å®š</span></a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>


    <style>
      body {
        background: #fff;
        min-height: 100vh;
      }
      .movie-page {
        max-width: 1100px;
        margin: 20px auto 40px;
        padding: 0 1.0rem 2.0rem;
        font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      }
      .movie-header {
        margin-bottom: 1.8rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 1.5rem;
      }
      .movie-title {
        font-size: 1.6rem;
        font-weight: 700;
        color: #2E7D32;
        letter-spacing: 0.06em;
        margin-bottom: 0.4rem;
        flex: 1;
      }
      .movie-subtitle {
        font-size: 0.98rem;
        color: #555;
        line-height: 1.7;
      }

      .movie-layout {
        display: block;
      }
      .movie-layout.video-selected {
        display: grid;
        grid-template-columns: 1fr;
      }
      .movie-layout.video-selected .control-panel {
        display: none;
      }

      /* è¨€èªãƒ»é …ç›®ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
      .control-panel {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
      }
      .panel-card {
        background: #ffffff;
        border-radius: 1.1rem;
        box-shadow: 0 4px 18px rgba(46, 125, 50, 0.10);
        padding: 1.1rem 1.3rem;
      }
      .panel-title {
        font-size: 0.98rem;
        font-weight: 600;
        color: #2E7D32;
        margin-bottom: 0.7rem;
        letter-spacing: 0.06em;
      }

      .lang-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }
      .lang-chip {
        border-radius: 999px;
        padding: 0.32rem 0.9rem;
        font-size: 0.85rem;
        border: 1px solid #C8E6C9;
        background: #F1F8E9;
        color: #33691E;
        cursor: pointer;
        transition: background 0.18s, color 0.18s, box-shadow 0.18s, border-color 0.18s;
        white-space: nowrap;
      }
      .lang-chip.is-active {
        background: linear-gradient(90deg, #A5D6B5 0%, #2E7D32 100%);
        color: #fff;
        border-color: transparent;
        box-shadow: 0 3px 12px rgba(46, 125, 50, 0.20);
      }

      .topic-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .topic-tab {
        border-radius: 0.9rem;
        padding: 0.45rem 1rem;
        font-size: 0.88rem;
        border: 1px solid #E0E0E0;
        background: #FFFFFF;
        color: #424242;
        cursor: pointer;
        transition: background 0.18s, color 0.18s, border-color 0.18s, box-shadow 0.18s;
      }
      .topic-tab.is-active {
        background: #E8F5E9;
        border-color: #81C784;
        color: #1B5E20;
        box-shadow: 0 3px 10px rgba(129, 199, 132, 0.35);
      }

      /* å†ç”Ÿã‚¨ãƒªã‚¢ */
      .player-card {
        background: #ffffff;
        border-radius: 1.1rem;
        box-shadow: 0 4px 18px rgba(46, 125, 50, 0.12);
        padding: 1.2rem 1.4rem 1.4rem;
      }
      .player-label {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 0.7rem;
      }
      .player-label-main {
        font-size: 0.96rem;
        font-weight: 600;
        color: #2E7D32;
      }
      .player-label-sub {
        font-size: 0.8rem;
        color: #757575;
      }
      .watch-video-button {
        background: linear-gradient(90deg, #A5D6B5 0%, #2E7D32 100%);
        color: #fff;
        border: none;
        padding: 0.7rem 1.5rem;
        border-radius: 0.8rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 3px 12px rgba(46, 125, 50, 0.25);
        transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
        margin-bottom: 1rem;
        width: 100%;
        letter-spacing: 0.02em;
      }
      .watch-video-button:hover {
        background: linear-gradient(90deg, #2E7D32 0%, #A5D6B5 100%);
        box-shadow: 0 4px 16px rgba(46, 125, 50, 0.35);
        transform: translateY(-1px);
      }
      .watch-video-button:active {
        transform: translateY(0);
      }
      .back-button {
        background: linear-gradient(90deg, #A5D6B5 0%, #2E7D32 100%);
        color: #fff;
        border: none;
        padding: 0.5rem 1.2rem;
        border-radius: 0.7rem;
        font-size: 0.88rem;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(46, 125, 50, 0.20);
        transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
        margin-bottom: 1rem;
        display: none;
      }
      .movie-layout.video-selected .back-button {
        display: inline-block;
      }
      .back-button:hover {
        background: linear-gradient(90deg, #2E7D32 0%, #A5D6B5 100%);
        box-shadow: 0 4px 12px rgba(46, 125, 50, 0.30);
        transform: translateY(-1px);
      }
      .player-wrapper {
        position: relative;
        width: 100%;
        border-radius: 0.9rem;
        overflow: hidden;
        background: #E0E0E0;
        aspect-ratio: 16 / 9;
      }
      .player-wrapper iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: none;
      }
      .player-placeholder {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        color: #616161;
        font-size: 0.9rem;
      }

      /* å‹•ç”»ãƒªã‚¹ãƒˆ */
      .video-list-card {
        margin-top: 1.2rem;
        background: #ffffff;
        border-radius: 1.1rem;
        box-shadow: 0 4px 18px rgba(46, 125, 50, 0.10);
        padding: 1.3rem 1.5rem 1.5rem;
      }
      .video-list-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 0.8rem;
      }
      .video-list-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: #424242;
      }
      .video-list-caption {
        font-size: 0.8rem;
        color: #9E9E9E;
      }
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 1rem;
        justify-items: stretch;
      }
      .video-card {
        border-radius: 1rem;
        padding: 1rem 1.1rem;
        border: 1px solid #E0E0E0;
        background: #FAFAFA;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        transition: border-color 0.15s, box-shadow 0.15s, background 0.15s, transform 0.12s;
        min-height: 90px;
        justify-content: space-between;
      }
      .video-card:hover {
        border-color: #81C784;
        box-shadow: 0 3px 10px rgba(129, 199, 132, 0.25);
        background: #FFFFFF;
        transform: translateY(-1px);
      }

      /* è¦–è´æ¸ˆã¿å‹•ç”»ã‚«ãƒ¼ãƒ‰ */
      .video-card.watched {
        background: #ffe0b2;
        border-color: #ff9800;
        box-shadow: 0 3px 10px rgba(255, 152, 0, 0.35);
      }
      .video-card.watched .video-lang {
        color: #f57c00;
        font-weight: 700;
      }
      .video-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: #424242;
        line-height: 1.4;
        flex: 1;
      }
      .video-meta {
        font-size: 0.82rem;
        color: #757575;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        margin-top: 0.2rem;
      }
      .video-lang {
        font-size: 0.8rem;
        color: #558B2F;
        font-weight: 500;
      }
      .video-topic-label {
        font-size: 0.78rem;
        color: #9E9E9E;
      }

      .video-empty {
        font-size: 0.85rem;
        color: #9E9E9E;
      }

      @media (max-width: 900px) {
        .movie-layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }
      @media (max-width: 640px) {
        .movie-page {
          margin-top: 20px;
          padding: 0 0.9rem 1.8rem;
        }
        .movie-header {
          flex-direction: column;
          gap: 1rem;
        }
        .movie-title {
          font-size: 1.35rem;
        }
        .player-card {
          padding-inline: 1rem;
        }
        .video-list-card {
          padding-inline: 1rem;
          padding-top: 1.1rem;
          padding-bottom: 1.3rem;
        }
        .video-grid {
          grid-template-columns: 1fr;
          gap: 0.9rem;
        }
        .video-card {
          padding: 0.9rem 1rem;
        }
      }
    </style>

    <main class="movie-page">
      <section class="movie-header">
        <div>
          <h1 class="movie-title" data-translate="movie_title">çµæ ¸å­¦ç¿’å‹•ç”»</h1>
          <p class="movie-subtitle">
            <span data-translate="movie_subtitle_line1">çµæ ¸ã«ã¤ã„ã¦ã€çŸ­ã„å‹•ç”»ã§ã‚ã‹ã‚Šã‚„ã™ãå­¦ã¹ã‚‹ãƒšãƒ¼ã‚¸ã§ã™ã€‚</span><br>
            <span data-translate="movie_subtitle_line2">è¦‹ãŸã„ã€Œé …ç›®ã€ã¨ã€Œå‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚’æŠ¼ã™ã¨ã€å‹•ç”»ã‚’è¦–è´ã™ã‚‹ã“ã¨ã§ãã¾ã™ã€‚</span>
          </p>
        </div>
      </section>

      <section class="movie-layout">
        <!-- å·¦ï¼šé …ç›®é¸æŠã¨å‹•ç”»ãƒªã‚¹ãƒˆ -->
        <div class="control-panel">
          <div class="panel-card" aria-label="å­¦ç¿’é …ç›®ã®é¸æŠ">
            <div class="panel-title" data-translate="learning_topics">å­¦ç¿’é …ç›®</div>
            <div class="topic-tabs" id="topicTabs">
              <button class="topic-tab is-active" data-topic="basic" data-translate="topic_basic">1.ãã®å’³ã€æœ¬å½“ã«é¢¨é‚ªã§ã™ã‹</button>
              <button class="topic-tab" data-topic="treatment" data-translate="topic_treatment">2.æ¥è§¦è€…å¥è¨º</button>
              <button class="topic-tab" data-topic="daily" data-translate="topic_daily">3.æ½œåœ¨æ€§çµæ ¸æ„ŸæŸ“ç—‡</button>
              <button class="topic-tab" data-topic="family" data-translate="topic_family">4.çµæ ¸</button>
            </div>
          </div>

          <div class="video-list-card">
            <div class="video-list-header">
              <div class="video-list-title" data-translate="video_list">å‹•ç”»ä¸€è¦§</div>
            </div>
            <div class="video-grid" id="videoGrid">
              <!-- â–¼â–¼ ã“ã“ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦è¤‡è£½ãƒ»ç·¨é›†ã—ã¦ãã ã•ã„ï¼‰ â–¼â–¼ -->
              <!-- é …ç›®â‘ ï¼šçµæ ¸ã¨ã¯ -->
              <button class="video-card"
                      data-topic="basic"
                      data-lang="ja"
                      data-url="https://www.youtube.com/embed/kYTbS2Q8_mo">
                <div class="video-title">1-1 çµæ ¸ã¨ã¯ã©ã‚“ãªç—…æ°—ã§ã—ã‚‡ã†ã‹</div>
                <div class="video-meta">
                  <span class="video-lang">æ—¥æœ¬èª / 5åˆ†</span>
                </div>
              </button>
              <button class="video-card"
                      data-topic="basic"
                      data-lang="ja"
                      data-url="https://www.youtube.com/embed/CYIUg0j3XgA">
                <div class="video-title">1-2 æ™®æ®µã‹ã‚‰å¿ƒãŒã‘ã‚‹äº‹</div>
                <div class="video-meta">
                  <span class="video-lang">æ—¥æœ¬èª / 5åˆ†</span>
                </div>
              </button>

              <!-- 1-1 çµæ ¸ã¨ã¯ã©ã‚“ãªç—…æ°—ã§ã—ã‚‡ã†ã‹ - å„è¨€èªç‰ˆ -->
              <button class="video-card"
                      data-topic="basic"
                      data-lang="en"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_EN_1_1">
                <div class="video-title">1-1 What is Tuberculosis?</div>
                <div class="video-meta">
                  <span class="video-lang">English / 5 min</span>
                </div>
              </button>
              <button class="video-card"
                      data-topic="basic"
                      data-lang="zh"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_ZH_1_1">
                <div class="video-title">1-1 ä»€ä¹ˆæ˜¯ç»“æ ¸ç—…ï¼Ÿ</div>
                <div class="video-meta">
                  <span class="video-lang">ä¸­å›½èª / 5åˆ†</span>
                </div>
              </button>
              <button class="video-card"
                      data-topic="basic"
                      data-lang="ko"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_KO_1_1">
                <div class="video-title">1-1 ê²°í•µì´ë€ ì–´ë–¤ ì§ˆë³‘ì¼ê¹Œìš”?</div>
                <div class="video-meta">
                  <span class="video-lang">í•œêµ­ì–´ / 5ë¶„</span>
                </div>
              </button>
              <button class="video-card"
                      data-topic="basic"
                      data-lang="vi"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_VI_1_1">
                <div class="video-title">1-1 Bá»‡nh lao lÃ  gÃ¬?</div>
                <div class="video-meta">
                  <span class="video-lang">ãƒ™ãƒˆãƒŠãƒ èª / 5åˆ†</span>
                </div>
              </button>


              <!-- 1-2 æ™®æ®µã‹ã‚‰å¿ƒãŒã‘ã‚‹äº‹ - å„è¨€èªç‰ˆ -->
              <button class="video-card"
                      data-topic="basic"
                      data-lang="en"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_EN_1_2">
                <div class="video-title">1-2 Things to Keep in Mind Daily</div>
                <div class="video-meta">
                  <span class="video-lang">English / 5 min</span>
                </div>
              </button>
              <button class="video-card"
                      data-topic="basic"
                      data-lang="zh"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_ZH_1_2">
                <div class="video-title">1-2 å¹³æ—¶è¦æ³¨æ„çš„äº‹é¡¹</div>
                <div class="video-meta">
                  <span class="video-lang">ä¸­å›½èª / 5åˆ†</span>
                </div>
              </button>
              <button class="video-card"
                      data-topic="basic"
                      data-lang="ko"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_KO_1_2">
                <div class="video-title">1-2 í‰ì†Œì— ë§ˆìŒì— ë‘ì–´ì•¼ í•  ê²ƒ</div>
                <div class="video-meta">
                  <span class="video-lang">í•œêµ­ì–´ / 5ë¶„</span>
                </div>
              </button>

              <button class="video-card"
                      data-topic="basic"
                      data-lang="vi"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_VI_1_2">
                <div class="video-title">1-2 Nhá»¯ng Ä‘iá»u cáº§n lÆ°u Ã½ hÃ ng ngÃ y</div>
                <div class="video-meta">
                  <span class="video-lang">ãƒ™ãƒˆãƒŠãƒ èª / 5åˆ†</span>
                </div>
              </button>


              <!-- é …ç›®â‘¡ï¼šæ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ -->
              <button class="video-card"
                      data-topic="treatment"
                      data-lang="ja"
                      data-url="https://www.youtube.com/embed/kYTbS2Q8_mo">
                <div class="video-title">2-1 çµæ ¸ã¨ã¯ã©ã‚“ãªç—…æ°—ã§ã—ã‚‡ã†ã‹</div>
                <div class="video-meta">
                  <span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
                  <span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
                </div>
              </button>
              <button class="video-card"
              data-topic="treatment"
              data-lang="ja"
              data-url="https://www.youtube.com/embed/oyT8tTqVB8c&t=1s">
        <div class="video-title">2-2 æ¥è§¦è€…å¥è¨ºã®å¿…è¦æ€§</div>
        <div class="video-meta">
          <span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
          <span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
        </div>
      </button>
      <button class="video-card"
      data-topic="treatment"
      data-lang="ja"
      data-url="https://www.youtube.com/embed/bF3ZapXxjM0">
<div class="video-title">2-3 æ¥è§¦è€…å¥è¨ºã§è¡Œã‚ã‚Œã‚‹æ¤œæŸ»</div>
<div class="video-meta">
  <span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
  <span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>
<button class="video-card"
data-topic="treatment"
data-lang="ja"
data-url="https://www.youtube.com/embed/0axWN7XpYS8">
<div class="video-title">2-4 IGRAæ¤œæŸ»ã®å®Ÿéš›</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
<span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>
<button class="video-card"
data-topic="treatment"
data-lang="ja"
data-url="https://www.youtube.com/embed/_BGetRCbfD4">
<div class="video-title">2-5 IGRAæ¤œæŸ»ã®çµæœ</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
<span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>
<button class="video-card"
data-topic="treatment"
data-lang="ja"
data-url="https://www.youtube.com/embed/pOfcHOCOnrg">
<div class="video-title">2-6 èƒ¸éƒ¨ã‚¨ãƒƒã‚¯ã‚¹ç·šæ¤œæŸ»</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
<span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>
<button class="video-card"
data-topic="treatment"
data-lang="ja"
data-url="https://www.youtube.com/embed/FZ0PyliDGps">
<div class="video-title">2-7 æ½œåœ¨æ€§çµæ ¸æ„ŸæŸ“ç—‡</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
<span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>
<button class="video-card"
data-topic="treatment"
data-lang="ja"
data-url="https://www.youtube.com/embed/bPyJ0OHpQnk">
<div class="video-title">2-8 æ½œåœ¨æ€§çµæ ¸æ„ŸæŸ“ç—‡ã®æ²»ç™‚</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
<span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>
<button class="video-card"
data-topic="treatment"
data-lang="ja"
data-url="https://www.youtube.com/embed/CYIUg0j3XgA">
<div class="video-title">2-9 æ™®æ®µã‹ã‚‰å¿ƒãŒã‘ã‚‹äº‹</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 7åˆ†</span>
<span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
</div>
</button>


              <button class="video-card"
                      data-topic="treatment"
                      data-lang="zh"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_ZH_2">
                <div class="video-title">çµæ ¸ã®æ¤œæŸ»ã¨æ²»ç™‚ï¼ˆä¸­å›½èªï¼‰</div>
                <div class="video-meta">
                  <span class="video-lang">ä¸­å›½èª / 7åˆ†</span>
                  <span class="video-topic-label">â‘¡ æ¤œæŸ»ãƒ»æ²»ç™‚ãƒ»å†…æœ</span>
                </div>
              </button>

              <!-- é …ç›®â‘¢ï¼šæ—¥å¸¸ç”Ÿæ´»ã®æ³¨æ„ç‚¹ -->
              <button class="video-card"
                      data-topic="daily"
                      data-lang="ja"
                      data-url="https://www.youtube.com/embed/FZ0PyliDGps">
                <div class="video-title">3-1 æ½œåœ¨æ€§çµæ ¸æ„ŸæŸ“ç—‡</div>
                <div class="video-meta">
                  <span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
                </div>
              </button>
              <button class="video-card"
              data-topic="daily"
              data-lang="ja"
              data-url="https://www.youtube.com/embed/ndsp3jf5o8w">
        <div class="video-title">3-2 çµæ ¸ã«ä¿‚ã‚‹é–¢ä¿‚æ©Ÿé–¢ã®å½¹å‰²</div>
        <div class="video-meta">
          <span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
        </div>
      </button>
      <button class="video-card"
      data-topic="daily"
      data-lang="ja"
      data-url="https://www.youtube.com/embed/bPyJ0OHpQnk">
<div class="video-title"> 3-3 æ½œåœ¨æ€§çµæ ¸æ„ŸæŸ“ç—‡ã®æ²»ç™‚</div>
<div class="video-meta">
  <span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="daily"
data-lang="ja"
data-url="https://www.youtube.com/embed/D1JEzJIIMrs">
<div class="video-title">3-4 æœè–¬ç¢ºèª(DOTS LTBI)</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="daily"
data-lang="ja"
data-url="https://www.youtube.com/embed/ATqheT_XdB4">
<div class="video-title">3-5 åŒ»ç™‚è²»å…¬è²»è² æ‹…åˆ¶åº¦</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="daily"
data-lang="ja"
data-url="https://www.youtube.com/embed/NGhsdT1IBCM">
<div class="video-title">3-6 åŒ»ç™‚è²»å…¬è²»è² æ‹…åˆ¶åº¦ã®æ‰‹ç¶š</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="daily"
data-lang="ja"
data-url="https://www.youtube.com/embed/b8YjxRcwj-g">
<div class="video-title">3-7 çµŒéè¦³å¯Ÿ(ç®¡ç†æ¤œè¨ºï¼‰</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="daily"
data-lang="ja"
data-url="https://www.youtube.com/embed/CYIUg0j3XgA">
<div class="video-title">3-8 æ™®æ®µã‹ã‚‰å¿ƒãŒã‘ã‚‹äº‹</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 6åˆ†</span>
</div>
</button>
              <button class="video-card"
                      data-topic="daily"
                      data-lang="tl"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_TL_3">
                <div class="video-title">Pamumuhay habang ginagamot ang TB (Tagalog)</div>
                <div class="video-meta">
                  <span class="video-lang">ã‚¿ã‚¬ãƒ­ã‚°èª / 6åˆ†</span>
                  <span class="video-topic-label">â‘¢ æ—¥å¸¸ç”Ÿæ´»</span>
                </div>
              </button>

              <!-- é …ç›®â‘£ï¼šå®¶æ—ãƒ»å‘¨å›²ã®äººã¸ -->
              <button class="video-card"
                      data-topic="family"
                      data-lang="ja"
                      data-url="https://www.youtube.com/embed/kYTbS2Q8_mo">
                <div class="video-title">4-1 çµæ ¸ã¨ã¯ã©ã‚“ãªç—…æ°—ã§ã—ã‚‡ã†ã‹ï¼Ÿ</div>
                <div class="video-meta">
                  <span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
                </div>
              </button>
              <button class="video-card"
              data-topic="family"
              data-lang="ja"
              data-url="https://www.youtube.com/embed/ndsp3jf5o8w">
        <div class="video-title">4-2 çµæ ¸ã«ä¿‚ã‚‹é–¢ä¿‚æ©Ÿé–¢ã®å½¹å‰²</div>
        <div class="video-meta">
          <span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
        </div>
      </button>
      <button class="video-card"
      data-topic="family"
      data-lang="ja"
      data-url="https://www.youtube.com/embed/t8erc35zVhI">
<div class="video-title">4-3 çµæ ¸æ²»ç™‚ã®åŸºæœ¬</div>
<div class="video-meta">
  <span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="family"
data-lang="ja"
data-url="https://www.youtube.com/embed/eqThpAMOtzw&t=19s">
<div class="video-title">4-4 çµæ ¸èŒã®æ¤œæŸ»</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="family"
data-lang="ja"
data-url="https://www.youtube.com/embed/I3WzCteNzE4">
<div class="video-title">4-5 æœè–¬ç¢ºèªï¼ˆDOTS TBï¼‰</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="family"
data-lang="ja"
data-url="https://www.youtube.com/embed/ATqheT_XdB4&t=10s">
<div class="video-title">4-6 åŒ»ç™‚è²»å…¬è²»è² æ‹…åˆ¶åº¦</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="family"
data-lang="ja"
data-url="https://www.youtube.com/embed/NGhsdT1IBCM&t=15s">
<div class="video-title"> 4-7 åŒ»ç™‚è²»å…¬è²»è² æ‹…åˆ¶åº¦ã®æ‰‹ç¶š</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="family"
data-lang="ja"
data-url="https://www.youtube.com/embed/b8YjxRcwj-g">
<div class="video-title">4-8 çµŒéè¦³å¯Ÿ(ç®¡ç†æ¤œè¨ºï¼‰</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
<button class="video-card"
data-topic="family"
data-lang="ja"
data-url="https://www.youtube.com/embed/CYIUg0j3XgA&t=10s">
<div class="video-title">4-9 æ™®æ®µã‹ã‚‰å¿ƒãŒã‘ã‚‹äº‹</div>
<div class="video-meta">
<span class="video-lang">æ—¥æœ¬èª / 4åˆ†</span>
</div>
</button>
              <button class="video-card"
                      data-topic="family"
                      data-lang="my"
                      data-url="https://www.youtube.com/embed/XXXXXXXX_MY_4">
                <div class="video-title">á€á€€á€ºá€›á€±á€¬á€€á€ºá€á€°á€™á€»á€¬á€¸á€¡á€á€½á€€á€º TB á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€á€»á€€á€º (á€™á€¼á€”á€ºá€™á€¬)</div>
                <div class="video-meta">
                  <span class="video-lang">ãƒŸãƒ£ãƒ³ãƒãƒ¼èª / 4åˆ†</span>
                  <span class="video-topic-label">â‘£ å®¶æ—ãƒ»å‘¨å›²</span>
                </div>
              </button>
              <!-- â–²â–² ã“ã“ã¾ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ â–²â–² -->
            </div>
            <p class="video-empty" id="videoEmptyMessage" style="display:none;">
              é¸æŠä¸­ã®è¨€èªãƒ»é …ç›®ã«ã¯ã€ã¾ã ç™»éŒ²ã•ã‚ŒãŸå‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>
              å¿…è¦ã«å¿œã˜ã¦ä¸Šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã€è¨€èªãƒ»é …ç›®ãƒ»URLã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            </p>
          </div>
        </div>
      </section>
    </main>

    <script>
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦è¡¨ç¤ºï¼ˆFirestoreã‹ã‚‰å–å¾—ï¼‰
      async function updateUserName() {
        const userNameDisplay = document.getElementById('userNameDisplay');
        if (!userNameDisplay) return;
        
        let auth = null;
        if (window.multiLang && window.multiLang.auth) {
          auth = window.multiLang.auth;
        } else if (typeof firebase !== 'undefined' && firebase.auth) {
          auth = firebase.auth();
        }
        
        if (!auth) {
          userNameDisplay.textContent = 'ã‚²ã‚¹ãƒˆ ã•ã‚“';
          return;
        }
        
        auth.onAuthStateChanged(async (user) => {
          if (!user) {
            userNameDisplay.textContent = 'ã‚²ã‚¹ãƒˆ ã•ã‚“';
            return;
          }
          
          try {
            // Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
            const db = firebase.firestore();
            const userDoc = await db.collection('users').doc(user.uid).get();
            
            if (userDoc.exists) {
              const userData = userDoc.data();
              // nameã®ã¿ã‚’ä½¿ç”¨
              const displayName = userData.name || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
              userNameDisplay.textContent = displayName + ' ã•ã‚“';
            } else {
              // Firestoreã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
              userNameDisplay.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã•ã‚“';
            }
          } catch (error) {
            console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
            userNameDisplay.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã•ã‚“';
          }
        });
      }

      document.addEventListener('DOMContentLoaded', function() {
        updateUserName();
        // å¤šè¨€èªå¯¾å¿œï¼ˆä»–ãƒšãƒ¼ã‚¸ã¨åŒã˜ä»•çµ„ã¿ã‚’åˆ©ç”¨ï¼‰
        if (window.multiLang && typeof window.multiLang.updateUI === 'function') {
          try { window.multiLang.updateUI(); } catch (_) {}
        }

        const topicTabs = document.querySelectorAll('.topic-tab');
        const videoCards = document.querySelectorAll('.video-card');
        const videoGrid = document.getElementById('videoGrid');
        const videoEmptyMessage = document.getElementById('videoEmptyMessage');
        const movieLayout = document.querySelector('.movie-layout');

        let currentLang = 'ja';
        let currentTopic = 'basic';

        // YouTubeãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’ä¿æŒ
        let ytPlayer = null;
        let currentVideoCard = null;

        // YouTube IFrame API ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦åˆ©ç”¨ï¼‰
        window.onYouTubeIframeAPIReady = function() {
          // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«ç‰¹åˆ¥ãªå‡¦ç†ã¯ä¸è¦ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”Ÿæˆã¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã«è¡Œã†ã€‚
        };

        // Firebaseèªè¨¼çŠ¶æ…‹ã‚’ç›£è¦–ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã‚’å–å¾—
        if (window.multiLang && window.multiLang.auth) {
          window.multiLang.auth.onAuthStateChanged(async (user) => {
            if (user && window.multiLang) {
              // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã‚’å–å¾—
              const userLanguage = await window.multiLang.getUserLanguage();
              if (userLanguage) {
                currentLang = userLanguage;
                // å‹•ç”»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ›´æ–°
                updateFilters();
              }
            } else if (!user) {
              // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èª
              currentLang = 'ja';
              updateFilters();
            }
          });
        }

        // multiLangã®è¨€èªå¤‰æ›´ã‚’ç›£è¦–
        if (window.multiLang) {
          // multiLangã®åˆæœŸåŒ–å®Œäº†ã‚’å¾…ã¤
          const checkMultiLang = setInterval(() => {
            if (window.multiLang && window.multiLang.currentLanguage) {
              const lang = window.multiLang.currentLanguage;
              if (currentLang !== lang) {
                currentLang = lang;
                updateFilters();
              }
              clearInterval(checkMultiLang);
            }
          }, 100);
          
          // 5ç§’å¾Œã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
          setTimeout(() => clearInterval(checkMultiLang), 5000);
        }

        function updateFilters() {
          let visibleCount = 0;
          videoCards.forEach(function(card) {
            const matchLang = card.dataset.lang === currentLang;
            const matchTopic = card.dataset.topic === currentTopic;
            if (matchLang && matchTopic) {
              card.style.display = '';
              visibleCount++;
            } else {
              card.style.display = 'none';
            }
          });
          if (visibleCount === 0) {
            videoEmptyMessage.style.display = '';
          } else {
            videoEmptyMessage.style.display = 'none';
          }
        }


        topicTabs.forEach(function(tab) {
          tab.addEventListener('click', function() {
            topicTabs.forEach(function(t) { t.classList.remove('is-active'); });
            this.classList.add('is-active');
            currentTopic = this.dataset.topic;
            updateFilters();
          });
        });

        if (videoGrid) {
          videoGrid.addEventListener('click', function(e) {
            const card = e.target.closest('.video-card');
            if (!card) return;
            let url = card.dataset.url || '';
            if (!url) {
              alert('ã“ã®å‹•ç”»ã«ã¯ã¾ã URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚YouTube ã®URLã‚’ data-url å±æ€§ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚');
              return;
            }

            // ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ï¼ˆè¦–è´å®Œäº†æ™‚ã«ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ã™ã‚‹ãŸã‚ï¼‰
            currentVideoCard = card;
            
            const langText = card.querySelector('.video-lang')?.textContent || '';
            const titleText = card.querySelector('.video-title')?.textContent || '';

            // enablejsapi=1 ã‚’ä»˜ä¸ï¼ˆã™ã§ã«ä»˜ã„ã¦ã„ãªã‘ã‚Œã°ï¼‰
            if (!url.includes('enablejsapi=1')) {
              url += (url.includes('?') ? '&' : '?') + 'enablejsapi=1';
            }
            
            // å‹•ç”»ãƒªã‚¹ãƒˆã‚’éè¡¨ç¤ºã«ã—ã¦ã€ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®ã¿ã‚’è¡¨ç¤º
            if (movieLayout) {
              movieLayout.classList.add('video-selected');
              
              // å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ã‚’å‹•çš„ã«ä½œæˆ
              const playerArea = document.createElement('div');
              playerArea.className = 'player-card';
              playerArea.innerHTML = `
                <button class="back-button" id="backButton" data-translate="back_to_video_list">â† å‹•ç”»ä¸€è¦§ã«æˆ»ã‚‹</button>
                <div class="player-label">
                  <div class="player-label-main">é¸æŠä¸­ã®å‹•ç”»</div>
                  <div class="player-label-sub">${titleText}${langText ? 'ï¼ˆ' + langText + 'ï¼‰' : ''}</div>
                </div>
                <div class="player-wrapper">
                  <div id="videoPlayer"></div>
                </div>
              `;
              
              // æ—¢å­˜ã®ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ãŒã‚ã‚Œã°å‰Šé™¤
              const existingPlayer = movieLayout.querySelector('.player-card');
              if (existingPlayer) {
                existingPlayer.remove();
              }
              
              movieLayout.appendChild(playerArea);

              // YouTube ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç”Ÿæˆï¼ˆAPI åˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰
              if (window.YT && YT.Player) {
                if (ytPlayer) {
                  ytPlayer.destroy();
                }
                ytPlayer = new YT.Player('videoPlayer', {
                  videoId: extractVideoId(url),
                  events: {
                    'onStateChange': onPlayerStateChange
                  }
                });
              } else {
                // API ãŒã¾ã ãªã‚‰é€šå¸¸ã® iframe ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦è¡¨ç¤º
                const container = document.getElementById('videoPlayer');
                if (container) {
                  container.innerHTML = `
                    <iframe
                      src="${url}"
                      title="çµæ ¸å­¦ç¿’å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      allowfullscreen
                    ></iframe>
                  `;
                }
              }
              
              // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
              const backBtn = playerArea.querySelector('#backButton');
              if (backBtn) {
                backBtn.addEventListener('click', function() {
                  if (movieLayout) {
                    movieLayout.classList.remove('video-selected');
                    const playerCard = movieLayout.querySelector('.player-card');
                    if (playerCard) {
                      playerCard.remove();
                    }
                  }
                });
              }
            }
          });
        }

        // YouTube URL ã‹ã‚‰ videoId ã‚’æŠ½å‡º
        function extractVideoId(url) {
          const match = url.match(/\/embed\/([^?&]+)/);
          return match ? match[1] : url;
        }

        // å†ç”ŸçŠ¶æ…‹ã®å¤‰åŒ–ã‚’ç›£è¦–ã—ã€çµ‚äº†ã—ãŸã‚‰ã‚«ãƒ¼ãƒ‰ã‚’ã€Œè¦–è´æ¸ˆã¿ã€ã«ã™ã‚‹
        function onPlayerStateChange(event) {
          if (event.data === YT.PlayerState.ENDED) {
            if (currentVideoCard) {
              currentVideoCard.classList.add('watched');
            }
          }
        }

        // åˆæœŸè¡¨ç¤ºï¼šç¾åœ¨ã®æ¡ä»¶ã«åˆã†å‹•ç”»ã ã‘ã‚’è¡¨ç¤º
        // multiLangã®åˆæœŸåŒ–ã‚’å¾…ã£ã¦ã‹ã‚‰åˆæœŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
        setTimeout(() => {
          if (window.multiLang && window.multiLang.currentLanguage) {
            currentLang = window.multiLang.currentLanguage;
          }
        updateFilters();
        }, 300);
      });
    </script>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer container">
      <small>
        <a href="#" data-translate="terms">åˆ©ç”¨è¦ç´„</a>
        <a href="#" data-translate="privacy">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a><br>
        &copy; <span data-translate="copyright_name">ã‚¹ãƒãƒ¼ãƒˆåŒ»ç™‚ãƒãƒ¼ã‚¿ãƒ«</span>
      </small>
    </footer>
</body>
</html>